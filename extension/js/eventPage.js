!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}({0:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.default={transitionEnd:function(){var e={transition:"transitionend",webkitTransition:"webkitTransitionEnd"},t=document.createElement("fake");for(var r in e)if(void 0!==t.style[r])return e[r];return!1},debounce:function(e,t,r){var n=null;return function(){var o=this,i=arguments,a=function(){n=null,r||e.apply(o,i)},c=r&&!n;clearTimeout(n),n=setTimeout(a,t),c&&e.apply(o,i)}},trigger:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=new Event(e,n({bubbles:!1,cancelable:!1},r));t.dispatchEvent(o)},templater:function(e,t){return e.replace(/\%(.*?)\%/g,function(e,r){return t[r]||""})},notifications:function(e,t){t=t||e,chrome.notifications.create(t,{type:"basic",iconUrl:"icons/icon128.png",title:"Visual bookmarks",message:e},function(){})},imageLoaded:function(e,t){var r=new Image;r.onload=function(){t.done&&t.done(e)},r.onerror=function(){t.fail&&t.fail(e)},r.src=e},base64ToBlob:function(e,t,r){for(var n=e,o=t||"",i=atob(n.split(",")[1]),a=new ArrayBuffer(i.length),c=new Uint8Array(a),u=0;u<i.length;u++)c[u]=i.charCodeAt(u);var l=new Blob([a],{type:o});return r?r(l):l},resizeScreen:function(e,t){var r=new Image;r.onload=function(){300<r.height&&(r.width*=300/r.height,r.height=300);var e=document.createElement("canvas"),n=e.getContext("2d");e.width=r.width,e.height=r.height,n.drawImage(r,0,0,r.width,r.height),t(e.toDataURL("image/jpg"))},r.src=e},rand:function(e,t){return Math.round(e-.5+Math.random()*(t-e+1))},getDomain:function(e){return e.replace(/(https?|ftps?|chrome|chrome-extension|file):\/\/\/?(www.)?/i,"").replace(/:?\/.*/i,"")}}},1:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t="";switch(e.name){case"QuotaExceededError":t="QuotaExceededError";break;case"NotFoundError":t="NotFoundError";break;case"SecurityError":t="SecurityError";break;case"InvalidModificationError":t="InvalidModificationError";break;case"InvalidStateError":t="InvalidStateError";break;default:t="Unknown Error"}console.error(t)}var t=null;return{init:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments[1];navigator.webkitPersistentStorage.requestQuota(1048576*r,function(r){window.webkitRequestFileSystem(window.PERSISTENT,r,function(e){t=e,n&&n()},e)},e)},usedAndRemaining:function(e){navigator.webkitPersistentStorage.queryUsageAndQuota(function(t,r){e&&e(t,r)})},createDir:function(r,n){t.root.getDirectory(r,{create:!0},function(e){n&&n(e)},e)},getDir:function(r,n){t.root.getDirectory(r,{},function(e){n&&n(e)},e)},deleteDir:function(r,n,o){n=n||{},void 0===n.recursive&&(n.recursive=!1),t.root.getDirectory(r,{},function(t){n.recursive?t.removeRecursively(function(){o&&o()},e):t.remove(function(){o&&o()},e)},e)},createFile:function(e,r,n){t.root.getFile(e,{create:!0},function(e){e.createWriter(function(t){t.onwriteend=function(){n&&n(e)},t.onerror=function(e){console.log(e)};var o=new Blob([r.file],{type:r.fileType});t.write(o)})})},deleteFile:function(r,n){t.root.getFile(r,{create:!1},function(t){t.remove(function(){n&&n()},e)},e)},purge:function(){t.root.createReader().readEntries(function(t){for(var r,n=0;r=t[n];++n)r.isDirectory?r.removeRecursively(function(){},e):r.remove(function(){},e);console.info("Local storage emptied.")},e)}}}();t.default=n},15:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r={url:e,focused:!1,left:1e5,top:1e5,width:1,height:1,type:"popup"},n=void 0,o=!1;chrome.windows.create(r,function(e){function r(){if(1==o)return clearTimeout(i),!1;chrome.tabs.get(n.id,function(n){"complete"==n.status?setTimeout(function(){chrome.tabs.captureVisibleTab(e.id,function(r){t({capture:r,title:n.title}),clearTimeout(i);try{chrome.windows.remove(e.id)}catch(e){}})},300):setTimeout(function(){r()},500)})}if(!e.tabs||!e.tabs.length)return chrome.windows.remove(e.id),console.error("not found page"),!1;n=e.tabs[0],chrome.tabs.update(n.id,{muted:!0});try{chrome.tabs.executeScript(n.id,{code:'document.addEventListener("DOMContentLoaded", function(){document.body.style.overflow = "hidden";});',runAt:"document_start"})}catch(e){console.warn(e)}var i=setTimeout(function(){chrome.windows.remove(e.id),t({error:"long_load",url:n.url}),o=!0},15e3);chrome.windows.update(e.id,{width:1170,height:720,top:1e5,left:1e5},function(){r()})})}function i(e){chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.bookmarks.search(e.pageUrl,function(r){r.some(function(t){return t.url===e.pageUrl})?l.default.notifications(chrome.i18n.getMessage("notice_bookmark_exist")):chrome.bookmarks.create({parentId:window.localStorage.getItem("default_folder_id"),url:e.pageUrl,title:t[0].title},function(e){l.default.notifications(chrome.i18n.getMessage("notice_bookmark_created")),o(e.url,function(t){l.default.resizeScreen(t.capture,function(t){var r=l.default.base64ToBlob(t,"image/jpg"),n=l.default.getDomain(e.url)+"_"+e.id+".jpg";c.default.createDir("images",function(t){c.default.createFile(t.fullPath+"/"+n,{file:r,fileType:r.type},function(t){var r=JSON.parse(localStorage.getItem("custom_dials"));r[e.id]=t.toURL(),localStorage.setItem("custom_dials",JSON.stringify(r))})})})})})})})}var a=r(1),c=n(a),u=r(0),l=n(u);c.default.init(500),chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.create({id:"create-bookmarks",title:chrome.i18n.getMessage("add_bookmark"),contexts:["page"]})}),chrome.contextMenus.onClicked.addListener(function(e){switch(e.menuItemId){case"create-bookmarks":i(e)}}),chrome.runtime.onMessage.addListener(function(e,t,r){if(e.captureUrl)return o(e.captureUrl,function(t){if(t&&t.error){try{r({warning:"Timeout waiting for a screenshot"})}catch(e){}return console.warn("Timeout waiting for a screenshot "+t.url),!1}l.default.resizeScreen(t.capture,function(t){var n=l.default.base64ToBlob(t,"image/jpg"),o=l.default.getDomain(e.captureUrl)+"_"+e.id+".jpg";c.default.createDir("images",function(t){c.default.createFile(t.fullPath+"/"+o,{file:n,fileType:n.type},function(t){var n=JSON.parse(localStorage.getItem("custom_dials"));n[e.id]=t.toURL(),localStorage.setItem("custom_dials",JSON.stringify(n)),console.info("Image file saved as "+t.toURL());try{r(t.toURL())}catch(e){}})})})}),!0}),chrome.browserAction.onClicked.addListener(function(){var e=[chrome.extension.getURL("newtab.html"),"chrome://newtab/"];chrome.tabs.query({currentWindow:!0},function(t){for(var r,n=0;r=t[n];n++)if(r.url&&~e.indexOf(r.url))return chrome.tabs.update(r.id,{active:!0});return chrome.tabs.create({url:chrome.extension.getURL("newtab.html")})})})}});